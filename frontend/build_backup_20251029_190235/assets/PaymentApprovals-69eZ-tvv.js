var e=(e,r,t)=>new Promise((a,s)=>{var d=e=>{try{n(t.next(e))}catch(r){s(r)}},l=e=>{try{n(t.throw(e))}catch(r){s(r)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(d,l);n((t=t.apply(e,r)).next())});import{c as r,j as t,a,d as s}from"./index-C51gkgTL.js";import{b as d}from"./react-vendor-DvHQdeg3.js";import{a as l}from"./utils-BQl1bh9w.js";import n from"./AdminLayout-CMkjnJ0Q.js";import{D as i}from"./dollar-sign-B3ilV4n7.js";import"./shield-g5XA3brV.js";import"./log-out-CN7QnmUZ.js";import"./users-BYYRZZOI.js";import"./trending-up-DFk693IJ.js";import"./credit-card-xZJ-8T2r.js";import"./chart-column-C7hhm_KL.js";import"./settings-Ca2oHKgQ.js";import"./chevron-right-tAjOH0ux.js";
/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o=r("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),x="/api/v1",c=()=>{var r,c;const[m,g]=d.useState([]),[p,u]=d.useState([]),[y,b]=d.useState(!0),[h,j]=d.useState(null),[v,f]=d.useState(null),[k,N]=d.useState(!1),[w,A]=d.useState(null),[S,q]=d.useState(""),[P,$]=d.useState(""),[C,R]=d.useState(!1),[_,D]=d.useState(null),[F,T]=d.useState(0);d.useEffect(()=>{z()},[]);const z=()=>e(null,null,function*(){var e,r;try{b(!0);const e={Authorization:`Bearer ${localStorage.getItem("token")}`},r=yield l.get(`${x}/payment-approvals/pending`,{headers:e});g(r.data.data||[]);const t=yield l.get(`${x}/payment-approvals/stats`,{headers:e});D(t.data.data||{}),j(null)}catch(t){j((null==(r=null==(e=t.response)?void 0:e.data)?void 0:r.error)||"Failed to load approval requests")}finally{b(!1)}}),I=(e,r)=>{f(e),A(r),N(!0),q(""),$("")},B=()=>{N(!1),f(null),A(null),q(""),$("")},M=e=>`$${parseFloat(e).toFixed(2)}`;return y?t.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:t.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-gray-300 border-t-transparent dark:border-neutral-700 dark:border-t-transparent"})}):t.jsx(n,{children:t.jsxs("div",{className:"p-4 md:p-6",children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Payment Approvals"}),h&&t.jsx("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 px-4 py-3 text-red-800 dark:border-red-800/50 dark:bg-red-900/30 dark:text-red-300",children:h}),_&&t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Pending"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:_.pending||0})]}),t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Approved"}),t.jsx("p",{className:"text-2xl font-semibold text-green-600 dark:text-green-400",children:_.approved||0})]}),t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Rejected"}),t.jsx("p",{className:"text-2xl font-semibold text-red-600 dark:text-red-400",children:_.rejected||0})]}),t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Total"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:_.total||0})]})]}),t.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-neutral-800",children:t.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Pending Approval Requests"})}),t.jsx("div",{className:"p-4",children:0===m.length?t.jsx("div",{className:"rounded-md border border-blue-200 bg-blue-50 px-4 py-3 text-blue-800 dark:border-blue-800/50 dark:bg-blue-900/30 dark:text-blue-300",children:"No pending approval requests"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-neutral-800/50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"ID"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Requester"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Trader"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Amount"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Type"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Date"}),t.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-600 dark:text-gray-300",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-neutral-800",children:m.map(e=>{var r,d,l,n,x,c,m;return t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-neutral-800/60",children:[t.jsx("td",{className:"px-4 py-3 align-top text-gray-900 dark:text-gray-100",children:e.id}),t.jsxs("td",{className:"px-4 py-3 align-top",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:(null==(r=e.requester)?void 0:r.name)||"N/A"}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:(null==(d=e.requester)?void 0:d.email)||""}),t.jsx("div",{className:"mt-1 inline-flex items-center rounded-full border border-gray-300 dark:border-neutral-700 px-2 py-0.5 text-xs text-gray-700 dark:text-gray-300",children:(null==(l=e.requester)?void 0:l.role)||"N/A"})]}),t.jsxs("td",{className:"px-4 py-3 align-top",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:(null==(n=e.trader)?void 0:n.name)||"N/A"}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:(null==(x=e.trader)?void 0:x.email)||""})]}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:M(e.amount)})}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset "+("cash"===e.payment_type?"text-blue-700 bg-blue-50 ring-blue-200 dark:text-blue-300 dark:bg-blue-950/40 dark:ring-blue-900/50":"text-purple-700 bg-purple-50 ring-purple-200 dark:text-purple-300 dark:bg-purple-950/40 dark:ring-purple-900/50"),children:[(m=e.payment_type,"cash"===m?t.jsx(i,{className:"h-4 w-4"}):t.jsx(o,{className:"h-4 w-4"})),e.payment_type.toUpperCase()]})}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:(c=e.created_at,c?new Date(c).toLocaleString():"N/A")})}),t.jsx("td",{className:"px-4 py-3 align-top",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{className:"inline-flex items-center gap-1.5 rounded-md bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 text-xs font-medium focus:outline-none focus:ring-2 focus:ring-green-500/50 disabled:opacity-50",onClick:()=>I(e,"approve"),children:[t.jsx(a,{className:"h-4 w-4"}),"Approve"]}),t.jsxs("button",{className:"inline-flex items-center gap-1.5 rounded-md bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 text-xs font-medium focus:outline-none focus:ring-2 focus:ring-red-500/50 disabled:opacity-50",onClick:()=>I(e,"reject"),children:[t.jsx(s,{className:"h-4 w-4"}),"Reject"]})]})})]},e.id)})})]})})})]}),k&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:B}),t.jsxs("div",{className:"relative w-full max-w-lg mx-4 rounded-lg border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 shadow-lg",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-neutral-800",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"approve"===w?"Approve Payment":"Reject Payment"})}),t.jsx("div",{className:"p-4",children:v&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:[t.jsx("strong",{children:"Requester:"})," ",null==(r=v.requester)?void 0:r.name]}),t.jsxs("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:[t.jsx("strong",{children:"Trader:"})," ",null==(c=v.trader)?void 0:c.name]}),t.jsxs("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:[t.jsx("strong",{children:"Amount:"})," ",M(v.amount)]}),t.jsxs("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:[t.jsx("strong",{children:"Payment Type:"})," ",v.payment_type.toUpperCase()]}),"reject"===w&&t.jsxs("div",{className:"pt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rejection Reason *"}),t.jsx("textarea",{className:"w-full rounded-md border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,value:P,onChange:e=>$(e.target.value),required:!0})]}),t.jsxs("div",{className:"pt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Admin Notes (Optional)"}),t.jsx("textarea",{className:"w-full rounded-md border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,value:S,onChange:e=>q(e.target.value)})]})]})}),t.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-neutral-800 flex justify-end gap-2",children:[t.jsx("button",{className:"inline-flex items-center rounded-md border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",onClick:B,disabled:C,children:"Cancel"}),t.jsx("button",{onClick:"approve"===w?()=>e(null,null,function*(){var e,r;if(v)try{R(!0);const e={Authorization:`Bearer ${localStorage.getItem("token")}`};yield l.post(`${x}/payment-approvals/${v.id}/approve`,{admin_notes:S},{headers:e}),yield z(),B(),alert("Payment approved successfully!")}catch(t){alert((null==(r=null==(e=t.response)?void 0:e.data)?void 0:r.error)||"Failed to approve request")}finally{R(!1)}}):()=>e(null,null,function*(){var e,r;if(v&&P.trim())try{R(!0);const e={Authorization:`Bearer ${localStorage.getItem("token")}`};yield l.post(`${x}/payment-approvals/${v.id}/reject`,{rejection_reason:P,admin_notes:S},{headers:e}),yield z(),B(),alert("Payment rejected")}catch(t){alert((null==(r=null==(e=t.response)?void 0:e.data)?void 0:r.error)||"Failed to reject request")}finally{R(!1)}else alert("Please provide a rejection reason")}),className:"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium text-white focus:outline-none focus:ring-2 disabled:opacity-50 "+("approve"===w?"bg-green-600 hover:bg-green-700 focus:ring-green-500/50":"bg-red-600 hover:bg-red-700 focus:ring-red-500/50"),disabled:C||"reject"===w&&!P.trim(),children:C?t.jsx("span",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white/60 border-t-transparent"}):"approve"===w?"Approve":"Reject"})]})]})]})]})})};export{c as default};
