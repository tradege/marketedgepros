var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=(e,t,a)=>new Promise((s,l)=>{var r=e=>{try{o(a.next(e))}catch(t){l(t)}},n=e=>{try{o(a.throw(e))}catch(t){l(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,n);o((a=a.apply(e,t)).next())});import{c,j as d,S as i,a as x,X as m}from"./index-ClO6sKb2.js";import{h as u,u as h,b as g,k as b}from"./react-vendor-DX2RpXDf.js";import{a as p}from"./utils-BqmvKC_F.js";import{A as y}from"./arrow-left-CysOF2vc.js";import{T as j}from"./trash-2-DyzaIN4q.js";import{M as v}from"./mail-SaibYyFi.js";import{P as f}from"./phone-0MUDQHRd.js";import{M as N}from"./map-pin-dnVZVq22.js";import{D as w}from"./dollar-sign-BHxUVU3g.js";import{P as C}from"./plus-C9bHLG5_.js";import{C as k}from"./calendar-KU-w_AnF.js";
/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=c("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),P=p.create({baseURL:"/api/v1",timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!0});P.interceptors.request.use(e=>{if(["POST","PUT","DELETE","PATCH"].includes(e.method.toUpperCase())){const t=localStorage.getItem("csrf_token");t&&(e.headers["X-CSRF-Token"]=t)}return e},e=>Promise.reject(e)),P.interceptors.response.use(e=>e,e=>{var t,a,s;return 401===(null==(t=e.response)?void 0:t.status)&&(localStorage.removeItem("user"),window.location.pathname.includes("/login")||(window.location.href="/login")),null==(a=e.response)||a.status,null==(s=e.response)||s.status,Promise.reject(e)});const F=()=>{var e;const{id:c}=u(),p=h(),[F,L]=g.useState(null),[$,A]=g.useState(!0),[O,D]=g.useState("overview"),[E,T]=g.useState(""),[U,_]=g.useState([]),[M,q]=g.useState(!1),[I,B]=g.useState(!1),[R,z]=g.useState(!1),[H,Q]=g.useState(""),[J,W]=g.useState(""),[X,G]=g.useState({name:"",email:"",phone:"",company:"",location:"",source:"",budget:"",status:"new",score:0});g.useEffect(()=>{K(),V()},[c]);const K=()=>o(null,null,function*(){try{const e=yield P.get(`/crm/leads/${c}`);L(e.data),G({name:e.data.name||"",email:e.data.email||"",phone:e.data.phone||"",company:e.data.company||"",location:e.data.location||"",source:e.data.source||"",budget:e.data.budget||"",status:e.data.status||"new",score:e.data.score||0}),A(!1)}catch(e){A(!1)}}),V=()=>o(null,null,function*(){try{const e=yield P.get(`/crm/leads/${c}/notes`);_(e.data.notes||[])}catch(e){}}),Y=(e,o)=>{G(c=>{return d=((e,t)=>{for(var a in t||(t={}))l.call(t,a)&&n(e,a,t[a]);if(s)for(var a of s(t))r.call(t,a)&&n(e,a,t[a]);return e})({},c),t(d,a({[e]:o}));var d})},Z=e=>({new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-purple-500",negotiation:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[e]||"bg-gray-500");return $?d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):F?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsxs("button",{onClick:()=>p("/admin/crm"),className:"flex items-center text-gray-400 hover:text-white",children:[d.jsx(y,{className:"w-5 h-5 mr-2"}),"Back to CRM"]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>{z(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center",children:[d.jsx(S,{className:"w-4 h-4 mr-2"}),"Edit"]}),d.jsxs("button",{onClick:()=>o(null,null,function*(){if(window.confirm("Are you sure you want to delete this lead?"))try{yield P.delete(`/crm/leads/${c}`),p("/admin/crm")}catch(e){alert("Failed to delete lead")}}),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center",children:[d.jsx(j,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),d.jsx("div",{className:"bg-gray-800 rounded-lg p-6 mb-6 border border-gray-700",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mr-4",children:F.name?F.name.charAt(0).toUpperCase():"L"}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-white",children:F.name||"Unnamed Lead"}),d.jsx("p",{className:"text-gray-400",children:F.company||"No company"})]})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:`px-4 py-2 rounded-full text-white text-sm font-semibold ${Z(F.status)}`,children:(null==(e=F.status)?void 0:e.toUpperCase())||"NEW"}),d.jsxs("div",{className:"text-right",children:[d.jsx("p",{className:"text-gray-400 text-sm",children:"Score"}),d.jsx("p",{className:"text-2xl font-bold "+(ee=F.score,ee>=70?"text-green-500":ee>=40?"text-yellow-500":"text-red-500"),children:F.score||0})]})]})]})}),d.jsx("div",{className:"mb-6",children:d.jsxs("div",{className:"flex gap-2 border-b border-gray-700",children:[d.jsx("button",{onClick:()=>D("overview"),className:"px-6 py-3 font-semibold "+("overview"===O?"text-cyan-500 border-b-2 border-cyan-500":"text-gray-400 hover:text-white"),children:"Overview"}),d.jsxs("button",{onClick:()=>D("notes"),className:"px-6 py-3 font-semibold "+("notes"===O?"text-cyan-500 border-b-2 border-cyan-500":"text-gray-400 hover:text-white"),children:["Notes (",U.length,")"]}),d.jsx("button",{onClick:()=>D("activity"),className:"px-6 py-3 font-semibold "+("activity"===O?"text-cyan-500 border-b-2 border-cyan-500":"text-gray-400 hover:text-white"),children:"Activity"})]})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[d.jsxs("div",{className:"lg:col-span-2 space-y-6",children:["overview"===O&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Contact Information"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center text-gray-300",children:[d.jsx(v,{className:"w-5 h-5 mr-3 text-cyan-500"}),d.jsx("span",{children:F.email||"No email"})]}),d.jsxs("div",{className:"flex items-center text-gray-300",children:[d.jsx(f,{className:"w-5 h-5 mr-3 text-cyan-500"}),d.jsx("span",{children:F.phone||"No phone"})]}),d.jsxs("div",{className:"flex items-center text-gray-300",children:[d.jsx(N,{className:"w-5 h-5 mr-3 text-cyan-500"}),d.jsx("span",{children:F.location||"No location"})]})]})]}),d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Lead Details"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Source"}),d.jsx("p",{className:"text-white font-semibold",children:F.source||"Unknown"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Budget"}),d.jsxs("p",{className:"text-white font-semibold flex items-center",children:[d.jsx(w,{className:"w-4 h-4 mr-1"}),F.budget||"Not specified"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Created"}),d.jsx("p",{className:"text-white font-semibold",children:F.created_at?new Date(F.created_at).toLocaleDateString():"N/A"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Last Updated"}),d.jsx("p",{className:"text-white font-semibold",children:F.updated_at?new Date(F.updated_at).toLocaleDateString():"N/A"})]})]})]})]}),"notes"===O&&d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Notes"}),d.jsxs("div",{className:"mb-6",children:[d.jsx("textarea",{value:E,onChange:e=>T(e.target.value),placeholder:"Add a note...",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-500 mb-2",rows:"3"}),d.jsxs("button",{onClick:()=>o(null,null,function*(){if(E.trim())try{yield P.post(`/crm/leads/${c}/notes`,{content:E}),T(""),V(),alert("Note added successfully!")}catch(e){alert("Failed to add note")}}),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 flex items-center",children:[d.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Note"]})]}),d.jsx("div",{className:"space-y-4",children:0===U.length?d.jsx("p",{className:"text-gray-400 text-center py-8",children:"No notes yet"}):U.map((e,t)=>d.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[d.jsx("p",{className:"text-white mb-2",children:e.content}),d.jsx("p",{className:"text-gray-400 text-sm",children:e.created_at?new Date(e.created_at).toLocaleString():"Just now"})]},t))})]}),"activity"===O&&d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Activity Log"}),d.jsx("p",{className:"text-gray-400 text-center py-8",children:"Activity tracking coming soon"})]})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Quick Actions"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("button",{onClick:()=>{(null==F?void 0:F.email)?window.location.href=`mailto:${F.email}`:alert("No email address available for this lead")},className:"w-full px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 flex items-center justify-center",children:[d.jsx(i,{className:"w-4 h-4 mr-2"}),"Send Email"]}),d.jsxs("button",{onClick:()=>{B(!0)},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center",children:[d.jsx(k,{className:"w-4 h-4 mr-2"}),"Schedule Follow-up"]}),d.jsxs("button",{onClick:()=>o(null,null,function*(){var e,t;if(window.confirm("Convert this lead to a customer? This will create a user account."))try{const e={email:F.email,name:F.name,phone:F.phone,role:"user",status:"active"};yield P.post("/users",e);yield P.patch(`/crm/leads/${c}`,{status:"converted"}),alert("Lead converted to customer successfully!"),p("/admin/users")}catch(a){(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)?alert(`Failed to convert lead: ${a.response.data.error}`):alert("Failed to convert lead. The email might already be registered.")}}),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center justify-center",children:[d.jsx(x,{className:"w-4 h-4 mr-2"}),"Convert to Customer"]})]})]}),d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Change Status"}),d.jsx("div",{className:"space-y-2",children:["new","contacted","qualified","negotiation","converted"].map(e=>d.jsx("button",{onClick:()=>{return t=e,o(null,null,function*(){try{yield P.patch(`/crm/leads/${c}`,{status:t}),yield K(),alert(`Status changed to ${t}`)}catch(e){alert("Failed to update status")}});var t},className:`w-full px-4 py-2 rounded-lg text-white ${Z(e)} hover:opacity-80 ${F.status===e?"ring-2 ring-white":""}`,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]})]})]}),I&&b.createPortal(d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md border border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-bold text-white",children:"Schedule Follow-up"}),d.jsx("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-white",children:d.jsx(m,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Follow-up Date & Time"}),d.jsx("input",{type:"datetime-local",value:H,onChange:e=>Q(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Notes (Optional)"}),d.jsx("textarea",{value:J,onChange:e=>W(e.target.value),placeholder:"Add notes about this follow-up...",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-500",rows:"3"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>o(null,null,function*(){if(H)try{const e=`ðŸ“… Follow-up scheduled for ${H}${J?"\n"+J:""}`;yield P.post(`/crm/leads/${c}/notes`,{content:e,note_type:"followup",followup_date:H}),B(!1),Q(""),W(""),V(),alert("Follow-up scheduled successfully!")}catch(e){alert("Failed to schedule follow-up")}else alert("Please select a follow-up date")}),className:"flex-1 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Schedule"}),d.jsx("button",{onClick:()=>B(!1),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Cancel"})]})]})]})}),document.body),R&&b.createPortal(d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl border border-gray-700 max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-bold text-white",children:"Edit Lead"}),d.jsx("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-white",children:d.jsx(m,{className:"w-5 h-5"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Name"}),d.jsx("input",{type:"text",value:X.name,onChange:e=>Y("name",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Email"}),d.jsx("input",{type:"email",value:X.email,onChange:e=>Y("email",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Phone"}),d.jsx("input",{type:"tel",value:X.phone,onChange:e=>Y("phone",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Company"}),d.jsx("input",{type:"text",value:X.company,onChange:e=>Y("company",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Location"}),d.jsx("input",{type:"text",value:X.location,onChange:e=>Y("location",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Source"}),d.jsx("input",{type:"text",value:X.source,onChange:e=>Y("source",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Budget"}),d.jsx("input",{type:"text",value:X.budget,onChange:e=>Y("budget",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Score (0-100)"}),d.jsx("input",{type:"number",min:"0",max:"100",value:X.score,onChange:e=>Y("score",parseInt(e.target.value)||0),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-gray-400 text-sm mb-2",children:"Status"}),d.jsxs("select",{value:X.status,onChange:e=>Y("status",e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-500",children:[d.jsx("option",{value:"new",children:"New"}),d.jsx("option",{value:"contacted",children:"Contacted"}),d.jsx("option",{value:"qualified",children:"Qualified"}),d.jsx("option",{value:"negotiation",children:"Negotiation"}),d.jsx("option",{value:"converted",children:"Converted"}),d.jsx("option",{value:"lost",children:"Lost"})]})]}),d.jsxs("div",{className:"flex gap-2 pt-4",children:[d.jsx("button",{onClick:()=>o(null,null,function*(){try{yield P.patch(`/crm/leads/${c}`,X),z(!1),yield K(),alert("Lead updated successfully!")}catch(e){alert("Failed to update lead")}}),className:"flex-1 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Save Changes"}),d.jsx("button",{onClick:()=>z(!1),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Cancel"})]})]})]})}),document.body)]}):d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Lead Not Found"}),d.jsx("button",{onClick:()=>p("/admin/crm"),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Back to CRM"})]})});var ee};export{F as default};
