var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&n(e,s,t[s]);return e},i=(e,a)=>t(e,s(a)),c=(e,t,s)=>new Promise((a,r)=>{var l=e=>{try{d(s.next(e))}catch(t){r(t)}},n=e=>{try{d(s.throw(e))}catch(t){r(t)}},d=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,n);d((s=s.apply(e,t)).next())});import{c as o,j as x,i as m,X as g,k as u,l as h}from"./index-CG8H-s3H.js";import{b as p}from"./react-vendor-DX2RpXDf.js";import{a as b}from"./utils-BqmvKC_F.js";import{U as y}from"./user-BS60kTSX.js";import{M as j}from"./mail-C-Sm0iir.js";import{P as f}from"./phone-Cwibr_QU.js";import{S as v}from"./shield-Bqbs4lW-.js";import{A as N}from"./activity-57bT2nu-.js";import{C as w}from"./calendar-DE32Y4hN.js";import{U as k}from"./users-DHCJz8ye.js";import{a as _,C as S}from"./copy-CP0TMFf8.js";import{C}from"./chevron-down-CzjX-aPp.js";import{C as $}from"./chevron-right-CiLz3VAM.js";import{U as A}from"./user-check-DImVjbzX.js";
/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=o("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),I=o("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),L=o("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),P=o("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function D({userId:e,onClose:t}){const[s,a]=p.useState(null),[r,l]=p.useState(null),[n,d]=p.useState(null),[i,o]=p.useState(null),[u,h]=p.useState(null),[_,S]=p.useState(!0),[C,$]=p.useState(null);p.useEffect(()=>{A()},[e]);const A=()=>c(null,null,function*(){try{S(!0);const t=localStorage.getItem("access_token"),s=yield b.get(`/api/v1/admin/users/${e}/full-details`,{headers:{Authorization:`Bearer ${t}`}});a(s.data.user),l(s.data.downline),d(s.data.challenges),o(s.data.payments),h(s.data.commissions),$(null)}catch(t){$("Failed to load user details")}finally{S(!1)}});if(_)return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:x.jsx("div",{className:"text-xl",children:"Loading..."})})});if(C||!s)return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[x.jsx("div",{className:"text-red-600",children:C||"User not found"}),x.jsx("button",{onClick:t,className:"mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Close"})]})});const z=m(s.role),I=(e=>{const t={approved:{color:"bg-green-100 text-green-800",label:"Approved"},pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},rejected:{color:"bg-red-100 text-red-800",label:"Rejected"},not_submitted:{color:"bg-gray-100 text-gray-800",label:"Not Submitted"}};return t[e]||t.not_submitted})(s.kyc_status);return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1400},children:x.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl mx-auto my-8 max-h-[85vh] flex flex-col",children:[x.jsxs("div",{className:"sticky top-0 bg-gray-800 border-b border-gray-700 px-6 py-4 flex justify-between items-center",children:[x.jsx("h2",{className:"text-2xl font-bold text-white",children:"User Details"}),x.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:x.jsx(g,{className:"w-6 h-6"})})]}),x.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(y,{className:"w-5 h-5"}),"Basic Information"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Full Name"}),x.jsxs("p",{className:"text-lg font-medium text-white",children:[s.first_name," ",s.last_name]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Email"}),x.jsxs("p",{className:"text-lg font-medium text-white flex items-center gap-2",children:[x.jsx(j,{className:"w-4 h-4"}),s.email]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Phone"}),x.jsxs("p",{className:"text-lg font-medium text-white flex items-center gap-2",children:[x.jsx(f,{className:"w-4 h-4"}),s.country_code," ",s.phone||"Not provided"]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Role"}),x.jsx("p",{children:x.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${z.color}`,children:z.label})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(v,{className:"w-5 h-5"}),"Account Status"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Status"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.is_active?"Active":"Inactive"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Email Verified"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.is_verified?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:s.is_verified?"Verified":"Not Verified"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"KYC Status"}),x.jsx("p",{children:x.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${I.color}`,children:I.label})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(N,{className:"w-5 h-5"}),"Activity"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Created"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString()]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Last Updated"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),new Date(s.updated_at).toLocaleDateString()]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Last Login"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"]})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Security"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Two-Factor Authentication"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.two_factor_enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.two_factor_enabled?"Enabled":"Disabled"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"User ID"}),x.jsxs("p",{className:"text-sm font-mono text-white",children:["#",s.id]})]})]})]}),r&&r.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(k,{className:"w-5 h-5"}),"Downline (",r.total_count," referrals)"]}),x.jsx("div",{className:"space-y-3",children:r.direct_referrals.map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-3 flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-white font-medium",children:e.name}),x.jsx("p",{className:"text-sm text-gray-400",children:e.email})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("span",{className:"px-2 py-1 text-xs rounded "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"}),x.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[e.children_count," referrals"]})]})]},e.id))})]}),n&&n.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Trading Challenges (",n.total_count,")"]}),x.jsx("div",{className:"space-y-3",children:n.list.map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-3",children:[x.jsxs("div",{className:"flex justify-between items-start mb-2",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-white font-medium",children:e.program_name}),x.jsxs("p",{className:"text-sm text-gray-400",children:["Account Size: $",e.account_size.toLocaleString()]})]}),x.jsx("span",{className:"px-2 py-1 text-xs rounded "+("active"===e.status?"bg-blue-100 text-blue-800":"completed"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"Balance:"}),x.jsxs("span",{className:"text-white ml-2",children:["$",e.current_balance.toLocaleString()]})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"P/L:"}),x.jsxs("span",{className:"ml-2 "+(e.profit_loss>=0?"text-green-400":"text-red-400"),children:["$",e.profit_loss.toLocaleString()]})]})]})]},e.id))})]}),i&&i.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Payments (",i.total_count,")"]}),x.jsxs("div",{className:"mb-3",children:[x.jsx("p",{className:"text-sm text-gray-400",children:"Total Paid:"}),x.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",i.total_amount.toLocaleString()]})]}),x.jsx("div",{className:"space-y-2",children:i.list.slice(0,5).map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-2 flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsxs("p",{className:"text-white",children:["$",e.amount.toLocaleString()]}),x.jsx("p",{className:"text-xs text-gray-400",children:e.payment_type})]}),x.jsx("span",{className:"px-2 py-1 text-xs rounded "+("completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})]},e.id))})]})]}),x.jsx("div",{className:"bg-gray-700 border-t border-gray-600 px-6 py-4 flex-shrink-0",children:x.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Close"})})]})})}const M="https://marketedgepros.com/api/v1",U=({userId:e,isOpen:t,onClose:s,onSuccess:a})=>{const[r,l]=p.useState(!1),[n,o]=p.useState(!1),[m,g]=p.useState(null),[u,h]=p.useState([]),[y,j]=p.useState({first_name:"",last_name:"",email:"",phone:"",country_code:"+972",role:"trader",is_active:!0,new_password:""});p.useEffect(()=>{t&&e&&(f(),v())},[t,e]);const f=()=>c(null,null,function*(){try{l(!0);const t=localStorage.getItem("access_token"),s=(yield b.get(`${M}/admin/users/${e}`,{headers:{Authorization:`Bearer ${t}`}})).data;j({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",country_code:s.country_code||"+972",role:s.role||"trader",is_active:!1!==s.is_active,new_password:""}),g(null)}catch(t){g("Failed to load user data")}finally{l(!1)}}),v=()=>c(null,null,function*(){try{const e=localStorage.getItem("access_token"),t=yield b.get(`${M}/roles`,{headers:{Authorization:`Bearer ${e}`}});h(t.data.roles||[])}catch(e){}}),N=e=>{const{name:t,value:s,type:a,checked:r}=e.target;j(e=>i(d({},e),{[t]:"checkbox"===a?r:s}))},w=t=>c(null,null,function*(){var r,l;t.preventDefault();try{o(!0),g(null);const t=localStorage.getItem("access_token"),r={first_name:y.first_name,last_name:y.last_name,email:y.email,phone:y.phone,country_code:y.country_code,role:y.role,is_active:y.is_active};y.new_password&&(r.password=y.new_password),yield b.put(`${M}/admin/users/${e}`,r,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a&&a(),s()}catch(n){g((null==(l=null==(r=n.response)?void 0:r.data)?void 0:l.error)||"Failed to update user")}finally{o(!1)}});return t?x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1400},children:x.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[x.jsx("h2",{className:"text-2xl font-bold text-white",children:"Edit User"}),x.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-2xl",children:"Ã—"})]}),x.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r?x.jsx("div",{className:"text-center py-8",children:x.jsx("div",{className:"text-xl text-white",children:"Loading..."})}):m?x.jsx("div",{className:"bg-red-900 text-red-200 p-4 rounded-lg mb-4",children:m}):x.jsxs("form",{onSubmit:w,className:"space-y-6",children:[x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Personal Information"}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"First Name"}),x.jsx("input",{type:"text",name:"first_name",value:y.first_name,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Last Name"}),x.jsx("input",{type:"text",name:"last_name",value:y.last_name,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Contact Information"}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Email"}),x.jsx("input",{type:"email",name:"email",value:y.email,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),x.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Country Code"}),x.jsxs("select",{name:"country_code",value:y.country_code,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[x.jsx("option",{value:"+972",children:"ðŸ‡®ðŸ‡± +972"}),x.jsx("option",{value:"+1",children:"ðŸ‡ºðŸ‡¸ +1"}),x.jsx("option",{value:"+44",children:"ðŸ‡¬ðŸ‡§ +44"}),x.jsx("option",{value:"+971",children:"ðŸ‡¦ðŸ‡ª +971"})]})]}),x.jsxs("div",{className:"col-span-2",children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Phone Number"}),x.jsx("input",{type:"tel",name:"phone",value:y.phone,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Role & Status"}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Role"}),x.jsx("select",{name:"role",value:y.role,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(e=>x.jsx("option",{value:e.name,children:e.label},e.id))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Status"}),x.jsx("div",{className:"flex items-center h-full",children:x.jsxs("label",{className:"flex items-center cursor-pointer",children:[x.jsx("input",{type:"checkbox",name:"is_active",checked:y.is_active,onChange:N,className:"w-5 h-5 text-blue-600 bg-gray-600 border-gray-500 rounded focus:ring-blue-500"}),x.jsx("span",{className:"ml-2 text-white",children:"Active"})]})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Password Reset (Optional)"}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"New Password"}),x.jsx("input",{type:"password",name:"new_password",value:y.new_password,onChange:N,placeholder:"Leave empty to keep current password",className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),x.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Leave empty if you don't want to change the password"})]})]})]})}),!r&&x.jsxs("div",{className:"flex justify-end gap-4 p-6 border-t border-gray-700",children:[x.jsx("button",{onClick:s,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",disabled:n,children:"Cancel"}),x.jsx("button",{onClick:w,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:n,children:n?"Saving...":"Save Changes"})]})]})}):null},q=({code:e,size:t="sm"})=>{const[s,a]=p.useState(!1);if(!e)return null;return x.jsxs("div",{className:"inline-flex items-center gap-1",children:[x.jsx("code",{className:`${{sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"}[t]} bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded font-mono`,children:e}),x.jsx("button",{onClick:()=>c(null,null,function*(){try{yield navigator.clipboard.writeText(e),a(!0),setTimeout(()=>a(!1),2e3)}catch(t){}}),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Copy referral code",children:s?x.jsx(_,{className:"w-4 h-4 text-green-600"}):x.jsx(S,{className:"w-4 h-4 text-gray-500"})})]})},F=({users:e,onUserClick:t})=>{const[s,a]=p.useState(new Set),r=e=>{switch(e){case"supermaster":return x.jsx(v,{className:"w-4 h-4 text-purple-400"});case"master":return x.jsx(L,{className:"w-4 h-4 text-blue-400"});case"agent":return x.jsx(k,{className:"w-4 h-4 text-green-400"});default:return x.jsx(y,{className:"w-4 h-4 text-gray-400"})}},l=e=>{switch(e){case"supermaster":return"bg-purple-900/30 text-purple-300 border-purple-700";case"master":return"bg-blue-900/30 text-blue-300 border-blue-700";case"agent":return"bg-green-900/30 text-green-300 border-green-700";default:return"bg-gray-800/30 text-gray-300 border-gray-700"}},n=({user:e,level:d=0})=>{const i=e.children&&e.children.length>0,c=s.has(e.id),o=24*d;return x.jsxs("div",{className:"border-l-2 border-gray-700/50",children:[x.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-gray-800/50 transition-colors",style:{paddingLeft:`${o+12}px`},children:[i?x.jsx("button",{type:"button",onMouseDown:t=>{var s;t.stopPropagation(),t.preventDefault(),s=e.id,a(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"p-2 hover:bg-gray-700/70 rounded transition-colors cursor-pointer flex-shrink-0 bg-green-900/20",style:{minWidth:"36px",minHeight:"36px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,position:"relative",border:"2px solid rgb(34, 197, 94)"},"aria-label":c?"Collapse":"Expand",children:c?x.jsx(C,{className:"w-6 h-6 text-green-400"}):x.jsx($,{className:"w-6 h-6 text-green-400"})}):x.jsx("div",{className:"w-10"}),x.jsx("div",{className:"flex-shrink-0",children:r(e.role)}),x.jsxs("div",{className:"flex-1 flex items-center gap-3 cursor-pointer hover:bg-gray-800/30 p-2 rounded",onClick:()=>t&&t(e),children:[x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs("span",{className:"text-sm font-medium text-gray-200 truncate",children:[e.first_name," ",e.last_name]}),x.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded border ${l(e.role)}`,children:e.role})]}),x.jsx("div",{className:"text-xs text-gray-400 truncate",children:e.email})]}),i&&x.jsxs("div",{className:"flex-shrink-0 px-2 py-1 bg-gray-800 rounded text-xs text-gray-400",children:[e.children.length," ",1===e.children.length?"user":"users"]}),x.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.is_verified&&x.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-900/30 text-green-300 rounded border border-green-700",children:"Verified"}),"approved"===e.kyc_status&&x.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-700",children:"KYC"})]})]})]}),i&&c&&x.jsx("div",{className:"bg-gray-900/30",children:e.children.map(e=>x.jsx(n,{user:e,level:d+1},e.id))})]})};return e&&0!==e.length?x.jsx("div",{className:"bg-gray-900 rounded-lg border border-gray-800 overflow-hidden",children:e.map(e=>x.jsx(n,{user:e,level:0},e.id))}):x.jsxs("div",{className:"text-center py-12 text-gray-400",children:[x.jsx(k,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),x.jsx("p",{children:"No users found"})]})},R="/api/v1";function T(){const[e,t]=p.useState([]),[s,a]=p.useState(!0),[r,l]=p.useState(null),[n,o]=p.useState(!1),[m,y]=p.useState(!1),[j,f]=p.useState(!1),[v,N]=p.useState(null),[w,_]=p.useState({first_name:"",last_name:"",email:"",password:"",phone:"",country_code:"+1",role:"trader"}),[S,C]=p.useState(""),[$,M]=p.useState(!1),[T,E]=p.useState(null),[O,B]=p.useState({page:1,per_page:10,total:0,pages:0}),[V,H]=p.useState({role:"",status:"",search:""}),[K,Y]=p.useState("table"),[J,W]=p.useState([]);p.useEffect(()=>{G(),"tree"===K?Q():X()},[O.page,V,K]);const G=()=>c(null,null,function*(){try{const e=localStorage.getItem("access_token"),t=yield b.get(`${R}/auth/me`,{headers:{Authorization:`Bearer ${e}`}});E(t.data.user)}catch(e){}}),Q=()=>c(null,null,function*(){try{a(!0);const e=localStorage.getItem("access_token"),t=yield b.get(`${R}/users/hierarchy`,{headers:{Authorization:`Bearer ${e}`}});W(t.data.users),l(null)}catch(e){l("Failed to load hierarchy")}finally{a(!1)}}),X=()=>c(null,null,function*(){try{a(!0);const e=localStorage.getItem("access_token"),s=new URLSearchParams({page:O.page.toString(),per_page:O.per_page.toString()});V.role&&s.append("role",V.role),V.status&&s.append("status",V.status),V.search&&s.append("search",V.search);const r=yield b.get(`${R}/admin/users?${s.toString()}`,{headers:{Authorization:`Bearer ${e}`}});t(r.data.users),B(e=>i(d({},e),{total:r.data.pagination.total,pages:r.data.pagination.pages})),l(null)}catch(e){l("Failed to load users")}finally{a(!1)}}),Z=e=>{B(t=>i(d({},t),{page:e}))},ee={super_admin:e.filter(e=>"super_admin"===e.role||"supermaster"===e.role).length,admin:e.filter(e=>"admin"===e.role).length,agent:e.filter(e=>"agent"===e.role).length,trader:e.filter(e=>"trader"===e.role).length};return s&&0===e.length?x.jsx("div",{className:"flex items-center justify-center h-screen",children:x.jsx("div",{className:"text-xl",children:"Loading..."})}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-white dark:text-white",children:"User Management"}),x.jsx("p",{className:"mt-2 text-sm text-gray-300 dark:text-gray-400",children:"Manage user accounts and permissions"})]}),x.jsxs("div",{className:"flex gap-3",children:[x.jsxs("div",{className:"flex gap-2 bg-slate-700 rounded-lg p-1",children:[x.jsxs("button",{onClick:()=>Y("table"),className:"px-3 py-2 rounded-md flex items-center gap-2 transition-colors "+("table"===K?"bg-blue-600 text-white":"text-gray-300 hover:text-white"),children:[x.jsx(z,{className:"w-4 h-4"}),"Table"]}),x.jsxs("button",{onClick:()=>Y("tree"),className:"px-3 py-2 rounded-md flex items-center gap-2 transition-colors "+("tree"===K?"bg-blue-600 text-white":"text-gray-300 hover:text-white"),children:[x.jsx(I,{className:"w-4 h-4"}),"Tree"]})]}),x.jsx("button",{onClick:()=>{if(T){const e=u(T.role);e.length>0&&_(t=>i(d({},t),{role:e[0].value}))}o(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add User"})]})]}),r&&x.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:r}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[x.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Super Admins"}),x.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:ee.super_admin}),x.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:"Full access"})]}),x.jsx(L,{className:"w-12 h-12 text-purple-600 dark:text-purple-400"})]})}),x.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Admins"}),x.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:ee.admin}),x.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"Platform managers"})]}),x.jsx(A,{className:"w-12 h-12 text-blue-600 dark:text-blue-400"})]})}),x.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Agents"}),x.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:ee.agent}),x.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Active agents"})]}),x.jsx(k,{className:"w-12 h-12 text-green-600 dark:text-green-400"})]})}),x.jsx("div",{className:"bg-slate-900 dark:bg-gray-700 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-gray-300 dark:text-gray-400",children:"Traders"}),x.jsx("p",{className:"text-2xl font-bold text-white dark:text-gray-100",children:ee.trader}),x.jsx("p",{className:"text-xs text-gray-300 dark:text-gray-400 mt-1",children:"Registered traders"})]}),x.jsx(P,{className:"w-12 h-12 text-gray-300 dark:text-gray-400"})]})})]}),x.jsx("div",{className:"bg-slate-800/50 dark:bg-gray-800 p-4 rounded-lg shadow",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Search"}),x.jsx("input",{type:"text",placeholder:"Search by name or email...",className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:V.search,onChange:e=>H(i(d({},V),{search:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Role"}),x.jsxs("select",{className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:V.role,onChange:e=>H(i(d({},V),{role:e.target.value})),children:[x.jsx("option",{value:"",children:"All Roles"}),x.jsx("option",{value:"super_admin",children:"Super Admin"}),x.jsx("option",{value:"admin",children:"Admin"}),x.jsx("option",{value:"agent",children:"Agent"}),x.jsx("option",{value:"trader",children:"Trader"})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),x.jsxs("select",{className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:V.status,onChange:e=>H(i(d({},V),{status:e.target.value})),children:[x.jsx("option",{value:"",children:"All Status"}),x.jsx("option",{value:"active",children:"Active"}),x.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})}),"tree"===K?x.jsx(F,{users:J,onUserClick:e=>{N(e.id),y(!0)}}):x.jsxs("div",{className:"bg-slate-800/50 dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full",children:[x.jsx("thead",{className:"bg-slate-900 dark:bg-gray-700",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"User"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"KYC"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Last Login"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Referral Code"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),x.jsx("tbody",{className:"bg-slate-800/50 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>{return x.jsxs("tr",{className:"hover:bg-slate-900 dark:hover:bg-gray-700",children:[x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsxs("div",{children:[x.jsxs("div",{className:"text-sm font-medium text-white dark:text-white",children:[e.first_name," ",e.last_name]}),x.jsx("div",{className:"text-sm text-gray-400 dark:text-gray-400",children:e.email})]})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${h(e.role).color}`,children:h(e.role).label})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(s=e.is_active,s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t=e.kyc_status,{approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",not_submitted:"bg-slate-700/50 text-gray-100"}[t]||"bg-slate-700/50 text-gray-100"}`,children:e.kyc_status.replace("_"," ")})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400 dark:text-gray-400",children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"Never"}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.referral_code?x.jsx(q,{code:e.referral_code,size:"sm"}):x.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-400",children:"â€”"})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400 dark:text-gray-400",children:new Date(e.created_at).toLocaleDateString()}),x.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[x.jsx("button",{onClick:()=>{N(e.id),y(!0)},className:"text-blue-600 hover:text-blue-900 mr-3",children:"View"}),x.jsx("button",{onClick:()=>{N(e.id),f(!0)},className:"text-green-600 hover:text-green-900 mr-3",children:"Edit"}),x.jsx("button",{onClick:()=>{return t=e.id,s=`${e.first_name} ${e.last_name}`,c(null,null,function*(){var e,a;if(window.confirm(`Are you sure you want to delete ${s}? This action cannot be undone.`))try{const e=localStorage.getItem("access_token");yield b.delete(`${R}/admin/users/${t}`,{headers:{Authorization:`Bearer ${e}`}}),X()}catch(r){alert((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.error)||"Failed to delete user")}});var t,s},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var t,s})})]})}),x.jsxs("div",{className:"bg-slate-900 dark:bg-gray-700 px-6 py-3 flex items-center justify-between",children:[x.jsxs("div",{className:"text-sm text-gray-200 dark:text-gray-300",children:["Showing ",(O.page-1)*O.per_page+1," to ",Math.min(O.page*O.per_page,O.total)," of ",O.total," users"]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>Z(O.page-1),disabled:1===O.page,className:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),x.jsxs("span",{className:"px-3 py-1",children:["Page ",O.page," of ",O.pages]}),x.jsx("button",{onClick:()=>Z(O.page+1),disabled:O.page>=O.pages,className:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}),n&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsxs("div",{className:"bg-slate-800/50 dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[x.jsxs("div",{className:"flex justify-between items-center mb-4",children:[x.jsx("h2",{className:"text-2xl font-bold text-white dark:text-white",children:"Add New User"}),x.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-200 dark:text-gray-400 dark:hover:text-gray-200",children:x.jsx(g,{className:"w-6 h-6"})})]}),S&&x.jsx("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:S}),x.jsxs("form",{onSubmit:e=>c(null,null,function*(){var t;e.preventDefault(),C(""),M(!0);try{const e=localStorage.getItem("access_token");yield b.post(`${R}/admin/users`,w,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),_({first_name:"",last_name:"",email:"",password:"",phone:"",country_code:"+1",role:"trader"}),o(!1),X()}catch(s){const e=null==(t=s.response)?void 0:t.data,a=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"Failed to create user",r=(null==e?void 0:e.error_code)?` (${e.error_code})`:"";C(a+r)}finally{M(!1)}}),className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"First Name"}),x.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.first_name,onChange:e=>_(i(d({},w),{first_name:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Last Name"}),x.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.last_name,onChange:e=>_(i(d({},w),{last_name:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Email"}),x.jsx("input",{type:"email",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.email,onChange:e=>_(i(d({},w),{email:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Password"}),x.jsx("input",{type:"password",required:!0,minLength:6,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.password,onChange:e=>_(i(d({},w),{password:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Phone Number"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs("select",{className:"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.country_code,onChange:e=>_(i(d({},w),{country_code:e.target.value})),children:[x.jsx("option",{value:"+1",children:"ðŸ‡ºðŸ‡¸ +1"}),x.jsx("option",{value:"+44",children:"ðŸ‡¬ðŸ‡§ +44"}),x.jsx("option",{value:"+971",children:"ðŸ‡¦ðŸ‡ª +971"})]}),x.jsx("input",{type:"tel",placeholder:"50-123-4567",className:"flex-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.phone,onChange:e=>_(i(d({},w),{phone:e.target.value}))})]}),x.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-400 mt-1",children:"Required for Master, Agent, and Trader roles"})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Role"}),x.jsx("select",{required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.role,onChange:e=>_(i(d({},w),{role:e.target.value})),children:T&&u(T.role).map(e=>x.jsx("option",{value:e.value,children:e.label},e.value))})]}),x.jsxs("div",{className:"flex gap-3 pt-4",children:[x.jsx("button",{type:"submit",disabled:$,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Creating...":"Create User"}),x.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-4 py-2 bg-gray-300 text-gray-200 rounded-lg hover:bg-gray-400 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:"Cancel"})]})]})]})}),m&&v&&x.jsx(D,{userId:v,onClose:()=>{y(!1),N(null)}}),j&&v&&x.jsx(U,{userId:v,isOpen:j,onClose:()=>{f(!1),N(null)},onSuccess:()=>{X()}})]})}export{T as default};
