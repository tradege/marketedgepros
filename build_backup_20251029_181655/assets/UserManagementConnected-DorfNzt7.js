var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(e,t)=>{for(var s in t||(t={}))l.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))r.call(t,s)&&n(e,s,t[s]);return e},i=(e,a)=>t(e,s(a)),c=(e,t,s)=>new Promise((a,l)=>{var r=e=>{try{d(s.next(e))}catch(t){l(t)}},n=e=>{try{d(s.throw(e))}catch(t){l(t)}},d=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,n);d((s=s.apply(e,t)).next())});import{c as o,j as x,i as m,X as g,k as u,l as h}from"./index-C96smR-l.js";import{b as p}from"./react-vendor-DvHQdeg3.js";import{a as b}from"./utils-BQl1bh9w.js";import{U as y}from"./user-8fzqY82w.js";import{M as j}from"./mail-nlneeubM.js";import{P as f}from"./phone-DJddHDag.js";import{S as v}from"./shield-B_xZZCOM.js";import{A as N}from"./activity-BKdnXbE4.js";import{C as w}from"./calendar-s5-4Pmbp.js";import{U as k}from"./users-zDGuyW7V.js";import{C as _}from"./check-D_0o1ssS.js";import{C as S}from"./copy-BFiVzTMA.js";import{U as C}from"./user-check-D7REgL81.js";
/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=o("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),A=o("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function L({userId:e,onClose:t}){const[s,a]=p.useState(null),[l,r]=p.useState(null),[n,d]=p.useState(null),[i,o]=p.useState(null),[u,h]=p.useState(null),[_,S]=p.useState(!0),[C,$]=p.useState(null);p.useEffect(()=>{A()},[e]);const A=()=>c(null,null,function*(){try{S(!0);const t=localStorage.getItem("access_token"),s=yield b.get(`/api/v1/admin/users/${e}/full-details`,{headers:{Authorization:`Bearer ${t}`}});a(s.data.user),r(s.data.downline),d(s.data.challenges),o(s.data.payments),h(s.data.commissions),$(null)}catch(t){$("Failed to load user details")}finally{S(!1)}});if(_)return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:x.jsx("div",{className:"text-xl",children:"Loading..."})})});if(C||!s)return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[x.jsx("div",{className:"text-red-600",children:C||"User not found"}),x.jsx("button",{onClick:t,className:"mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Close"})]})});const L=m(s.role),I=(e=>{const t={approved:{color:"bg-green-100 text-green-800",label:"Approved"},pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},rejected:{color:"bg-red-100 text-red-800",label:"Rejected"},not_submitted:{color:"bg-gray-100 text-gray-800",label:"Not Submitted"}};return t[e]||t.not_submitted})(s.kyc_status);return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1400},children:x.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-6xl m-4 max-h-[90vh] flex flex-col",children:[x.jsxs("div",{className:"sticky top-0 bg-gray-800 border-b border-gray-700 px-6 py-4 flex justify-between items-center",children:[x.jsx("h2",{className:"text-2xl font-bold text-white",children:"User Details"}),x.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-200",children:x.jsx(g,{className:"w-6 h-6"})})]}),x.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(y,{className:"w-5 h-5"}),"Basic Information"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Full Name"}),x.jsxs("p",{className:"text-lg font-medium text-white",children:[s.first_name," ",s.last_name]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Email"}),x.jsxs("p",{className:"text-lg font-medium text-white flex items-center gap-2",children:[x.jsx(j,{className:"w-4 h-4"}),s.email]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Phone"}),x.jsxs("p",{className:"text-lg font-medium text-white flex items-center gap-2",children:[x.jsx(f,{className:"w-4 h-4"}),s.country_code," ",s.phone||"Not provided"]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Role"}),x.jsx("p",{children:x.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${L.color}`,children:L.label})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(v,{className:"w-5 h-5"}),"Account Status"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Status"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.is_active?"Active":"Inactive"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Email Verified"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.is_verified?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:s.is_verified?"Verified":"Not Verified"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"KYC Status"}),x.jsx("p",{children:x.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${I.color}`,children:I.label})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(N,{className:"w-5 h-5"}),"Activity"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Created"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString()]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Last Updated"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),new Date(s.updated_at).toLocaleDateString()]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Last Login"}),x.jsxs("p",{className:"text-sm font-medium text-white flex items-center gap-2",children:[x.jsx(w,{className:"w-4 h-4"}),s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"]})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Security"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"Two-Factor Authentication"}),x.jsx("p",{children:x.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full "+(s.two_factor_enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.two_factor_enabled?"Enabled":"Disabled"})})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm text-gray-400",children:"User ID"}),x.jsxs("p",{className:"text-sm font-mono text-white",children:["#",s.id]})]})]})]}),l&&l.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(k,{className:"w-5 h-5"}),"Downline (",l.total_count," referrals)"]}),x.jsx("div",{className:"space-y-3",children:l.direct_referrals.map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-3 flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-white font-medium",children:e.name}),x.jsx("p",{className:"text-sm text-gray-400",children:e.email})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("span",{className:"px-2 py-1 text-xs rounded "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"}),x.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[e.children_count," referrals"]})]})]},e.id))})]}),n&&n.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Trading Challenges (",n.total_count,")"]}),x.jsx("div",{className:"space-y-3",children:n.list.map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-3",children:[x.jsxs("div",{className:"flex justify-between items-start mb-2",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-white font-medium",children:e.program_name}),x.jsxs("p",{className:"text-sm text-gray-400",children:["Account Size: $",e.account_size.toLocaleString()]})]}),x.jsx("span",{className:"px-2 py-1 text-xs rounded "+("active"===e.status?"bg-blue-100 text-blue-800":"completed"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"Balance:"}),x.jsxs("span",{className:"text-white ml-2",children:["$",e.current_balance.toLocaleString()]})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"P/L:"}),x.jsxs("span",{className:"ml-2 "+(e.profit_loss>=0?"text-green-400":"text-red-400"),children:["$",e.profit_loss.toLocaleString()]})]})]})]},e.id))})]}),i&&i.total_count>0&&x.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Payments (",i.total_count,")"]}),x.jsxs("div",{className:"mb-3",children:[x.jsx("p",{className:"text-sm text-gray-400",children:"Total Paid:"}),x.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",i.total_amount.toLocaleString()]})]}),x.jsx("div",{className:"space-y-2",children:i.list.slice(0,5).map(e=>x.jsxs("div",{className:"bg-gray-600 rounded p-2 flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsxs("p",{className:"text-white",children:["$",e.amount.toLocaleString()]}),x.jsx("p",{className:"text-xs text-gray-400",children:e.payment_type})]}),x.jsx("span",{className:"px-2 py-1 text-xs rounded "+("completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})]},e.id))})]})]}),x.jsx("div",{className:"bg-gray-700 border-t border-gray-600 px-6 py-4 flex-shrink-0",children:x.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Close"})})]})})}const I="https://marketedgepros.com/api/v1",P=({userId:e,isOpen:t,onClose:s,onSuccess:a})=>{const[l,r]=p.useState(!1),[n,o]=p.useState(!1),[m,g]=p.useState(null),[u,h]=p.useState([]),[y,j]=p.useState({first_name:"",last_name:"",email:"",phone:"",country_code:"+972",role:"trader",is_active:!0,new_password:""});p.useEffect(()=>{t&&e&&(f(),v())},[t,e]);const f=()=>c(null,null,function*(){try{r(!0);const t=localStorage.getItem("access_token"),s=(yield b.get(`${I}/admin/users/${e}`,{headers:{Authorization:`Bearer ${t}`}})).data;j({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",country_code:s.country_code||"+972",role:s.role||"trader",is_active:!1!==s.is_active,new_password:""}),g(null)}catch(t){g("Failed to load user data")}finally{r(!1)}}),v=()=>c(null,null,function*(){try{const e=localStorage.getItem("access_token"),t=yield b.get(`${I}/roles`,{headers:{Authorization:`Bearer ${e}`}});h(t.data.roles||[])}catch(e){}}),N=e=>{const{name:t,value:s,type:a,checked:l}=e.target;j(e=>i(d({},e),{[t]:"checkbox"===a?l:s}))},w=t=>c(null,null,function*(){var l,r;t.preventDefault();try{o(!0),g(null);const t=localStorage.getItem("access_token"),l={first_name:y.first_name,last_name:y.last_name,email:y.email,phone:y.phone,country_code:y.country_code,role:y.role,is_active:y.is_active};y.new_password&&(l.password=y.new_password),yield b.put(`${I}/admin/users/${e}`,l,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a&&a(),s()}catch(n){g((null==(r=null==(l=n.response)?void 0:l.data)?void 0:r.error)||"Failed to update user")}finally{o(!1)}});return t?x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1400},children:x.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[x.jsx("h2",{className:"text-2xl font-bold text-white",children:"Edit User"}),x.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-2xl",children:"Ã—"})]}),x.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:l?x.jsx("div",{className:"text-center py-8",children:x.jsx("div",{className:"text-xl text-white",children:"Loading..."})}):m?x.jsx("div",{className:"bg-red-900 text-red-200 p-4 rounded-lg mb-4",children:m}):x.jsxs("form",{onSubmit:w,className:"space-y-6",children:[x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Personal Information"}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"First Name"}),x.jsx("input",{type:"text",name:"first_name",value:y.first_name,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Last Name"}),x.jsx("input",{type:"text",name:"last_name",value:y.last_name,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Contact Information"}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Email"}),x.jsx("input",{type:"email",name:"email",value:y.email,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),x.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Country Code"}),x.jsxs("select",{name:"country_code",value:y.country_code,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[x.jsx("option",{value:"+972",children:"ðŸ‡®ðŸ‡± +972"}),x.jsx("option",{value:"+1",children:"ðŸ‡ºðŸ‡¸ +1"}),x.jsx("option",{value:"+44",children:"ðŸ‡¬ðŸ‡§ +44"}),x.jsx("option",{value:"+971",children:"ðŸ‡¦ðŸ‡ª +971"})]})]}),x.jsxs("div",{className:"col-span-2",children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Phone Number"}),x.jsx("input",{type:"tel",name:"phone",value:y.phone,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Role & Status"}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Role"}),x.jsx("select",{name:"role",value:y.role,onChange:N,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(e=>x.jsx("option",{value:e.name,children:e.label},e.id))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Status"}),x.jsx("div",{className:"flex items-center h-full",children:x.jsxs("label",{className:"flex items-center cursor-pointer",children:[x.jsx("input",{type:"checkbox",name:"is_active",checked:y.is_active,onChange:N,className:"w-5 h-5 text-blue-600 bg-gray-600 border-gray-500 rounded focus:ring-blue-500"}),x.jsx("span",{className:"ml-2 text-white",children:"Active"})]})})]})]})]}),x.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Password Reset (Optional)"}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"New Password"}),x.jsx("input",{type:"password",name:"new_password",value:y.new_password,onChange:N,placeholder:"Leave empty to keep current password",className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),x.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Leave empty if you don't want to change the password"})]})]})]})}),!l&&x.jsxs("div",{className:"flex justify-end gap-4 p-6 border-t border-gray-700",children:[x.jsx("button",{onClick:s,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors",disabled:n,children:"Cancel"}),x.jsx("button",{onClick:w,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:n,children:n?"Saving...":"Save Changes"})]})]})}):null},z=({code:e,size:t="sm"})=>{const[s,a]=p.useState(!1);if(!e)return null;return x.jsxs("div",{className:"inline-flex items-center gap-1",children:[x.jsx("code",{className:`${{sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"}[t]} bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded font-mono`,children:e}),x.jsx("button",{onClick:()=>c(null,null,function*(){try{yield navigator.clipboard.writeText(e),a(!0),setTimeout(()=>a(!1),2e3)}catch(t){}}),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Copy referral code",children:s?x.jsx(_,{className:"w-4 h-4 text-green-600"}):x.jsx(S,{className:"w-4 h-4 text-gray-500"})})]})},D="/api/v1";function q(){const[e,t]=p.useState([]),[s,a]=p.useState(!0),[l,r]=p.useState(null),[n,o]=p.useState(!1),[m,y]=p.useState(!1),[j,f]=p.useState(!1),[v,N]=p.useState(null),[w,_]=p.useState({first_name:"",last_name:"",email:"",password:"",phone:"",country_code:"+1",role:"trader"}),[S,I]=p.useState(""),[q,U]=p.useState(!1),[R,E]=p.useState(null),[F,O]=p.useState({page:1,per_page:10,total:0,pages:0}),[T,B]=p.useState({role:"",status:"",search:""});p.useEffect(()=>{M(),V()},[F.page,T]);const M=()=>c(null,null,function*(){try{const e=localStorage.getItem("access_token"),t=yield b.get(`${D}/auth/me`,{headers:{Authorization:`Bearer ${e}`}});E(t.data.user)}catch(e){}}),V=()=>c(null,null,function*(){try{a(!0);const e=localStorage.getItem("access_token"),s=new URLSearchParams({page:F.page.toString(),per_page:F.per_page.toString()});T.role&&s.append("role",T.role),T.status&&s.append("status",T.status),T.search&&s.append("search",T.search);const l=yield b.get(`${D}/admin/users?${s.toString()}`,{headers:{Authorization:`Bearer ${e}`}});t(l.data.users),O(e=>i(d({},e),{total:l.data.pagination.total,pages:l.data.pagination.pages})),r(null)}catch(e){r("Failed to load users")}finally{a(!1)}}),H=e=>{O(t=>i(d({},t),{page:e}))},K={super_admin:e.filter(e=>"super_admin"===e.role||"supermaster"===e.role).length,admin:e.filter(e=>"admin"===e.role).length,agent:e.filter(e=>"agent"===e.role).length,trader:e.filter(e=>"trader"===e.role).length};return s&&0===e.length?x.jsx("div",{className:"flex items-center justify-center h-screen",children:x.jsx("div",{className:"text-xl",children:"Loading..."})}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-white dark:text-white",children:"User Management"}),x.jsx("p",{className:"mt-2 text-sm text-gray-300 dark:text-gray-400",children:"Manage user accounts and permissions"})]}),x.jsx("button",{onClick:()=>{if(R){const e=u(R.role);e.length>0&&_(t=>i(d({},t),{role:e[0].value}))}o(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add User"})]}),l&&x.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:l}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[x.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Super Admins"}),x.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:K.super_admin}),x.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:"Full access"})]}),x.jsx($,{className:"w-12 h-12 text-purple-600 dark:text-purple-400"})]})}),x.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Admins"}),x.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:K.admin}),x.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"Platform managers"})]}),x.jsx(C,{className:"w-12 h-12 text-blue-600 dark:text-blue-400"})]})}),x.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Agents"}),x.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:K.agent}),x.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Active agents"})]}),x.jsx(k,{className:"w-12 h-12 text-green-600 dark:text-green-400"})]})}),x.jsx("div",{className:"bg-slate-900 dark:bg-gray-700 p-6 rounded-lg",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm text-gray-300 dark:text-gray-400",children:"Traders"}),x.jsx("p",{className:"text-2xl font-bold text-white dark:text-gray-100",children:K.trader}),x.jsx("p",{className:"text-xs text-gray-300 dark:text-gray-400 mt-1",children:"Registered traders"})]}),x.jsx(A,{className:"w-12 h-12 text-gray-300 dark:text-gray-400"})]})})]}),x.jsx("div",{className:"bg-slate-800/50 dark:bg-gray-800 p-4 rounded-lg shadow",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Search"}),x.jsx("input",{type:"text",placeholder:"Search by name or email...",className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:T.search,onChange:e=>B(i(d({},T),{search:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Role"}),x.jsxs("select",{className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:T.role,onChange:e=>B(i(d({},T),{role:e.target.value})),children:[x.jsx("option",{value:"",children:"All Roles"}),x.jsx("option",{value:"super_admin",children:"Super Admin"}),x.jsx("option",{value:"admin",children:"Admin"}),x.jsx("option",{value:"agent",children:"Agent"}),x.jsx("option",{value:"trader",children:"Trader"})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),x.jsxs("select",{className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",value:T.status,onChange:e=>B(i(d({},T),{status:e.target.value})),children:[x.jsx("option",{value:"",children:"All Status"}),x.jsx("option",{value:"active",children:"Active"}),x.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})}),x.jsxs("div",{className:"bg-slate-800/50 dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full",children:[x.jsx("thead",{className:"bg-slate-900 dark:bg-gray-700",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"User"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"KYC"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Last Login"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Referral Code"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),x.jsx("tbody",{className:"bg-slate-800/50 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>{return x.jsxs("tr",{className:"hover:bg-slate-900 dark:hover:bg-gray-700",children:[x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsxs("div",{children:[x.jsxs("div",{className:"text-sm font-medium text-white dark:text-white",children:[e.first_name," ",e.last_name]}),x.jsx("div",{className:"text-sm text-gray-400 dark:text-gray-400",children:e.email})]})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${h(e.role).color}`,children:h(e.role).label})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(s=e.is_active,s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t=e.kyc_status,{approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",not_submitted:"bg-slate-700/50 text-gray-100"}[t]||"bg-slate-700/50 text-gray-100"}`,children:e.kyc_status.replace("_"," ")})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400 dark:text-gray-400",children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"Never"}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.referral_code?x.jsx(z,{code:e.referral_code,size:"sm"}):x.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-400",children:"â€”"})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400 dark:text-gray-400",children:new Date(e.created_at).toLocaleDateString()}),x.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[x.jsx("button",{onClick:()=>{N(e.id),y(!0)},className:"text-blue-600 hover:text-blue-900 mr-3",children:"View"}),x.jsx("button",{onClick:()=>{N(e.id),f(!0)},className:"text-green-600 hover:text-green-900 mr-3",children:"Edit"}),x.jsx("button",{onClick:()=>{return t=e.id,s=`${e.first_name} ${e.last_name}`,c(null,null,function*(){var e,a;if(window.confirm(`Are you sure you want to delete ${s}? This action cannot be undone.`))try{const e=localStorage.getItem("access_token");yield b.delete(`${D}/admin/users/${t}`,{headers:{Authorization:`Bearer ${e}`}}),V()}catch(l){alert((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"Failed to delete user")}});var t,s},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var t,s})})]})}),x.jsxs("div",{className:"bg-slate-900 dark:bg-gray-700 px-6 py-3 flex items-center justify-between",children:[x.jsxs("div",{className:"text-sm text-gray-200 dark:text-gray-300",children:["Showing ",(F.page-1)*F.per_page+1," to ",Math.min(F.page*F.per_page,F.total)," of ",F.total," users"]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>H(F.page-1),disabled:1===F.page,className:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),x.jsxs("span",{className:"px-3 py-1",children:["Page ",F.page," of ",F.pages]}),x.jsx("button",{onClick:()=>H(F.page+1),disabled:F.page>=F.pages,className:"px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}),n&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsxs("div",{className:"bg-slate-800/50 dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[x.jsxs("div",{className:"flex justify-between items-center mb-4",children:[x.jsx("h2",{className:"text-2xl font-bold text-white dark:text-white",children:"Add New User"}),x.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-200 dark:text-gray-400 dark:hover:text-gray-200",children:x.jsx(g,{className:"w-6 h-6"})})]}),S&&x.jsx("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:S}),x.jsxs("form",{onSubmit:e=>c(null,null,function*(){var t;e.preventDefault(),I(""),U(!0);try{const e=localStorage.getItem("access_token");yield b.post(`${D}/admin/users`,w,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),_({first_name:"",last_name:"",email:"",password:"",phone:"",country_code:"+1",role:"trader"}),o(!1),V()}catch(s){const e=null==(t=s.response)?void 0:t.data,a=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"Failed to create user",l=(null==e?void 0:e.error_code)?` (${e.error_code})`:"";I(a+l)}finally{U(!1)}}),className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"First Name"}),x.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.first_name,onChange:e=>_(i(d({},w),{first_name:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Last Name"}),x.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.last_name,onChange:e=>_(i(d({},w),{last_name:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Email"}),x.jsx("input",{type:"email",required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.email,onChange:e=>_(i(d({},w),{email:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Password"}),x.jsx("input",{type:"password",required:!0,minLength:6,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.password,onChange:e=>_(i(d({},w),{password:e.target.value}))})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Phone Number"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs("select",{className:"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.country_code,onChange:e=>_(i(d({},w),{country_code:e.target.value})),children:[x.jsx("option",{value:"+1",children:"ðŸ‡ºðŸ‡¸ +1"}),x.jsx("option",{value:"+44",children:"ðŸ‡¬ðŸ‡§ +44"}),x.jsx("option",{value:"+971",children:"ðŸ‡¦ðŸ‡ª +971"})]}),x.jsx("input",{type:"tel",placeholder:"50-123-4567",className:"flex-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.phone,onChange:e=>_(i(d({},w),{phone:e.target.value}))})]}),x.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-400 mt-1",children:"Required for Master, Agent, and Trader roles"})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-200 dark:text-gray-300",children:"Role"}),x.jsx("select",{required:!0,className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:w.role,onChange:e=>_(i(d({},w),{role:e.target.value})),children:R&&u(R.role).map(e=>x.jsx("option",{value:e.value,children:e.label},e.value))})]}),x.jsxs("div",{className:"flex gap-3 pt-4",children:[x.jsx("button",{type:"submit",disabled:q,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:q?"Creating...":"Create User"}),x.jsx("button",{type:"button",onClick:()=>o(!1),className:"flex-1 px-4 py-2 bg-gray-300 text-gray-200 rounded-lg hover:bg-gray-400 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:"Cancel"})]})]})]})}),m&&v&&x.jsx(L,{userId:v,onClose:()=>{y(!1),N(null)}}),j&&v&&x.jsx(P,{userId:v,isOpen:j,onClose:()=>{f(!1),N(null)},onSuccess:()=>{V()}})]})}export{q as default};
